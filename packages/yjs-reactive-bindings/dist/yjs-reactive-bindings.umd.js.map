{"version":3,"file":"yjs-reactive-bindings.umd.js","sources":["../src/observableProvider.ts","../src/types/array.ts","../src/types/doc.ts","../src/types/map.ts","../src/types/text.ts","../src/types/xml.ts","../src/index.ts"],"sourcesContent":["export type Atom = {\n  /**\n   * Invoke this method to notify mobx that your atom has been used somehow.\n   * Returns true if there is currently a reactive context.\n   */\n  reportObserved(implicitObserver?: any): boolean;\n  /**\n   * Invoke this method _after_ this method has changed to signal mobx that all its observers should invalidate.\n   */\n  reportChanged(): void;\n};\n\nlet customCreateAtom: typeof createAtom | undefined;\nlet customReaction: ((func: () => any, effect: () => any) => any) | undefined;\n\nlet defaultReaction = (func: () => any) => func();\n\nexport function reaction(func: () => any, effect: () => any) {\n  if (customReaction) {\n    return customReaction(func, effect);\n  } else {\n    defaultReaction(func);\n    return undefined;\n  }\n}\n\nexport function createAtom(\n  _name: string,\n  _onBecomeObservedHandler?: () => void,\n  _onBecomeUnobservedHandler?: () => void\n): Atom {\n  if (customCreateAtom) {\n    return customCreateAtom.apply(null, arguments as any);\n  } else {\n    throw new Error(\n      \"observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.\"\n    );\n  }\n}\n\n/**\n * Enable MobX integration\n *\n * @param mobx An instance of mobx, e.g. import * as mobx from \"mobx\";\n */\nexport function enableMobxBindings(mobx: any) {\n  customCreateAtom = mobx.createAtom;\n  customReaction = undefined;\n}\n\n/**\n * Enable Vue3 integration\n *\n * @param vue An instance of Vue or Vue reactivity, e.g. import * as Vue from \"vue\";\n */\nexport function enableVueBindings(vue: any) {\n  customCreateAtom = function (name: any, onBecomeObserved: any) {\n    let id = 0;\n    const data = vue.reactive({ data: id });\n    const atom = {\n      reportObserved() {\n        return data.data as any as boolean;\n      },\n      reportChanged() {\n        data.data = ++id;\n      },\n    };\n    if (onBecomeObserved) {\n      onBecomeObserved();\n    }\n    return atom;\n  };\n  customReaction = undefined;\n}\n\nexport function enableReactiveBindings(reactive: any) {\n  customCreateAtom = function (name, onBecomeObserved, onBecomeUnobserved) {\n    // TMP\n    const atom = reactive.createAtom(name);\n    if (onBecomeObserved) {\n      onBecomeObserved();\n    }\n    return atom;\n  };\n  customReaction = (func: () => void, effect: () => void) => {\n    return reactive.reaction(func, effect, { fireImmediately: false });\n  };\n}\n","import * as Y from \"yjs\";\nimport { Atom, createAtom } from \"../observableProvider\";\n\nconst arraysObserved = new WeakSet<Y.Array<any>>();\n\nexport function observeArray(array: Y.Array<any>) {\n  if (arraysObserved.has(array)) {\n    // already patched\n    return array;\n  }\n  arraysObserved.add(array);\n\n  let selfAtom: Atom | undefined;\n  const atoms = new Map<number, Atom>();\n\n  function reportSelfAtom() {\n    if (!selfAtom) {\n      const handler = (event: Y.YArrayEvent<any>) => {\n        if (\n          event.changes.added.size ||\n          event.changes.deleted.size ||\n          event.changes.keys.size ||\n          event.changes.delta.length\n        ) {\n          selfAtom!.reportChanged();\n        }\n      };\n      selfAtom = createAtom(\n        \"map\",\n        () => {\n          array.observe(handler);\n        },\n        () => {\n          array.unobserve(handler);\n        }\n      );\n    }\n\n    selfAtom.reportObserved((array as any)._implicitObserver);\n  }\n\n  function reportArrayElementAtom(key: number) {\n    let atom = atoms.get(key);\n\n    // possible optimization: only register a single handler for all keys\n    if (!atom) {\n      const handler = (event: Y.YArrayEvent<any>) => {\n        // TODO: detect key of changed element\n        // if (event.keys.has(key + \"\")) {\n        //   if (\n        //     event.changes.added.size ||\n        //     event.changes.deleted.size ||\n        //     event.changes.keys.size ||\n        //     event.changes.delta.length\n        //   ) {\n        atom!.reportChanged();\n        // }\n      };\n      atom = createAtom(\n        key + \"\",\n        () => {\n          array.observe(handler);\n        },\n        () => {\n          array.unobserve(handler);\n        }\n      );\n      atoms.set(key, atom);\n    }\n\n    atom.reportObserved((array as any)._implicitObserver);\n  }\n\n  const originalGet = array.get;\n\n  array.get = function (key: number) {\n    if (typeof key !== \"number\") {\n      throw new Error(\"unexpected\");\n    }\n    reportArrayElementAtom(key);\n    const ret = Reflect.apply(originalGet, this, arguments);\n    return ret;\n  };\n\n  function patch(method: string) {\n    const originalFunction = array[method];\n    array[method] = function () {\n      reportSelfAtom();\n      const ret = Reflect.apply(originalFunction, this, arguments);\n      return ret;\n    };\n  }\n\n  function patchGetter(method: string) {\n    let target = array;\n    let descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n\n    // properties might be defined down the prototype chain (e.g., properties on XmlFragment when working on an XmlElement)\n    if (!descriptor) {\n      target = Object.getPrototypeOf(target);\n      descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n    }\n\n    if (!descriptor) {\n      target = Object.getPrototypeOf(target);\n      descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n    }\n\n    if (!descriptor) {\n      throw new Error(\"property not found\");\n    }\n\n    const originalFunction = descriptor.get!;\n    descriptor.get = function () {\n      if (!this._disableTracking) {\n        reportSelfAtom();\n      }\n      const ret = Reflect.apply(originalFunction, this, arguments);\n      return ret;\n    };\n    Object.defineProperty(array, method, descriptor);\n  }\n\n  function copyGetter(method: string, newMethodName: string) {\n    let target = array;\n    let descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n\n    // properties might be defined down the prototype chain (e.g., properties on XmlFragment when working on an XmlElement)\n    if (!descriptor) {\n      target = Object.getPrototypeOf(target);\n      descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n    }\n\n    if (!descriptor) {\n      target = Object.getPrototypeOf(target);\n      descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n    }\n\n    if (!descriptor) {\n      throw new Error(\"property not found\");\n    }\n\n    Object.defineProperty(array, newMethodName, descriptor);\n  }\n\n  patch(\"forEach\");\n  patch(\"toJSON\");\n  patch(\"toArray\");\n  patch(\"slice\");\n  patch(\"map\");\n  copyGetter(\"length\", \"lengthUntracked\");\n  patchGetter(\"length\");\n\n  // make push and slice use _disableTracking so calls to .length don't get observed\n  const originalPush = array.push;\n  array.push = function (this: any, content: any) {\n    this._disableTracking = true;\n    const ret = originalPush.call(this, content);\n    this._disableTracking = false;\n    return ret;\n  };\n\n  const originalSlice = array.slice;\n  array.slice = function (this: any, start: any, end: any) {\n    this._disableTracking = true;\n    const ret = originalSlice.call(this, start, end);\n    this._disableTracking = false;\n    return ret;\n  };\n  // TODO: iterator\n  return array;\n}\n","import * as Y from \"yjs\";\nimport { observeYJS } from \"..\";\nimport { Atom, createAtom, reaction } from \"../observableProvider\";\n\nconst docsObserved = new WeakSet<Y.Doc>();\n\n// TODO: add atoms, etc\nexport function observeDoc(doc: Y.Doc) {\n  if (docsObserved.has(doc)) {\n    // already patched\n    return doc;\n  }\n  docsObserved.add(doc);\n  let selfAtom: Atom | undefined;\n\n  function reportSelfAtom() {\n    if (!selfAtom) {\n      let oldKeys = Array.from(doc.share.keys());\n      const handler = (tr: any) => {\n        const newKeys = Array.from(doc.share.keys());\n        if (JSON.stringify(oldKeys) !== JSON.stringify(newKeys)) {\n          oldKeys = newKeys;\n          selfAtom!.reportChanged();\n        }\n      };\n      selfAtom = createAtom(\n        \"map\",\n        () => {\n          doc.on(\"beforeObserverCalls\", handler);\n        },\n        () => {\n          doc.off(\"beforeObserverCalls\", handler);\n        }\n      );\n    }\n    selfAtom.reportObserved((doc as any)._implicitObserver);\n  }\n\n  const originalGet = doc.get;\n\n  doc.get = function (key: string) {\n    if (typeof key !== \"string\") {\n      throw new Error(\"unexpected\");\n    }\n    const ret = Reflect.apply(originalGet, this, arguments);\n    observeYJS(ret);\n    return ret;\n  };\n\n  function patch(method: string) {\n    const originalFunction = doc[method];\n    let previous: any | undefined;\n\n    doc[method] = function () {\n      let ret: any;\n      let args = arguments;\n      reportSelfAtom();\n\n      if (previous) {\n        previous.removeObservers(); // dispose\n      }\n\n      // we run this in a reaction, because the originalfunction might also trigger\n      // observers in nested functions. In particular, if toJSON is called.\n      previous = reaction(\n        () => {\n          ret = Reflect.apply(originalFunction, doc, args);\n          return ret;\n        },\n        () => selfAtom!.reportChanged()\n      );\n\n      return ret;\n    };\n  }\n\n  patch(\"toJSON\");\n\n  Object.defineProperty(doc, \"keys\", {\n    get: () => {\n      reportSelfAtom();\n      return Object.keys(doc.share);\n    },\n  });\n\n  return doc;\n}\n","import { Atom, createAtom } from \"../observableProvider\";\nimport * as Y from \"yjs\";\n\nconst mapsObserved = new WeakSet<Y.Map<any>>();\n\nexport function observeMap(map: Y.Map<any>) {\n  if (mapsObserved.has(map)) {\n    // already patched\n    return map;\n  }\n  mapsObserved.add(map);\n  let selfAtom: Atom | undefined;\n  const atoms = new Map<string, Atom>();\n\n  function reportSelfAtom() {\n    if (!selfAtom) {\n      const handler = (event: Y.YMapEvent<any>) => {\n        if (\n          event.changes.added.size ||\n          event.changes.deleted.size ||\n          event.changes.keys.size ||\n          event.changes.delta.length\n        ) {\n          selfAtom!.reportChanged();\n        }\n      };\n      selfAtom = createAtom(\n        \"map\",\n        () => {\n          map.observe(handler);\n        },\n        () => {\n          map.unobserve(handler);\n        }\n      );\n    }\n    selfAtom.reportObserved((map as any)._implicitObserver);\n  }\n\n  function reportMapKeyAtom(key: string) {\n    let atom = atoms.get(key);\n\n    // possible optimization: only register a single handler for all keys\n    if (!atom) {\n      const handler = (event: Y.YMapEvent<any>) => {\n        if (event.keysChanged.has(key)) {\n          if (\n            event.changes.added.size ||\n            event.changes.deleted.size ||\n            event.changes.keys.size ||\n            event.changes.delta.length\n          ) {\n            atom!.reportChanged();\n          }\n        }\n      };\n      atom = createAtom(\n        key,\n        () => {\n          map.observe(handler);\n        },\n        () => {\n          map.unobserve(handler);\n        }\n      );\n      atoms.set(key, atom);\n    }\n\n    atom.reportObserved((map as any)._implicitObserver);\n  }\n\n  const originalGet = map.get;\n\n  map.get = function (key: string) {\n    if (typeof key !== \"string\") {\n      throw new Error(\"unexpected\");\n    }\n    reportMapKeyAtom(key);\n    const ret = Reflect.apply(originalGet, this, arguments);\n    return ret;\n  };\n\n  function patch(method: string) {\n    const originalFunction = map[method];\n    map[method] = function () {\n      reportSelfAtom();\n      const ret = Reflect.apply(originalFunction, this, arguments);\n      return ret;\n    };\n  }\n\n  patch(\"values\");\n  patch(\"entries\");\n  patch(\"keys\");\n  patch(\"forEach\");\n  patch(\"toJSON\");\n\n  // TODO: has, iterator\n  return map;\n}\n","import { Atom, createAtom } from \"../observableProvider\";\nimport * as Y from \"yjs\";\n\nconst textsObserved = new WeakSet<Y.Text>();\n\nexport function observeText(value: Y.Text) {\n  if (textsObserved.has(value)) {\n    // already patched\n    return value;\n  }\n  textsObserved.add(value);\n\n  let atom: Atom | undefined;\n\n  const handler = (_changes: Y.YTextEvent) => {\n    atom!.reportChanged();\n  };\n  atom = createAtom(\n    \"text\",\n    () => {\n      value.observe(handler);\n    },\n    () => {\n      value.unobserve(handler);\n    }\n  );\n\n  function patch(method: string) {\n    const originalFunction = value[method];\n    value[method] = function () {\n      atom!.reportObserved(this._implicitObserver);\n      const ret = Reflect.apply(originalFunction, this, arguments);\n      return ret;\n    };\n  }\n\n  patch(\"toString\");\n  patch(\"toJSON\");\n  return value;\n}\n","import * as Y from \"yjs\";\nimport { Atom, createAtom } from \"../observableProvider\";\n\nconst xmlsObserved = new WeakSet<Y.XmlFragment>();\n\nexport function observeXml(value: Y.XmlFragment) {\n  if (xmlsObserved.has(value)) {\n    // already patched\n    return value;\n  }\n  xmlsObserved.add(value);\n\n  let atom: Atom | undefined;\n\n  const handler = (event: Y.YXmlEvent) => {\n    if (\n      event.changes.added.size ||\n      event.changes.deleted.size ||\n      event.changes.keys.size ||\n      event.changes.delta.length\n    ) {\n      atom!.reportChanged();\n    }\n  };\n\n  atom = createAtom(\n    \"xml\",\n    () => {\n      value.observe(handler);\n    },\n    () => {\n      value.unobserve(handler);\n    }\n  );\n\n  function patch(method: string) {\n    const originalFunction = value[method];\n    value[method] = function () {\n      atom!.reportObserved(this._implicitObserver);\n      const ret = Reflect.apply(originalFunction, this, arguments);\n      return ret;\n    };\n  }\n\n  function patchGetter(method: string) {\n    let target = value;\n    let descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n\n    // properties might be defined down the prototype chain (e.g., properties on XmlFragment when working on an XmlElement)\n    if (!descriptor) {\n      target = Object.getPrototypeOf(target);\n      descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n    }\n\n    if (!descriptor) {\n      target = Object.getPrototypeOf(target);\n      descriptor = Object.getOwnPropertyDescriptor(target, method)!;\n    }\n\n    if (!descriptor) {\n      throw new Error(\"property not found\");\n    }\n\n    const originalFunction = descriptor.get!;\n    descriptor.get = function () {\n      atom!.reportObserved(this._implicitObserver);\n      const ret = Reflect.apply(originalFunction, this, arguments);\n      return ret;\n    };\n    Object.defineProperty(value, method, descriptor);\n  }\n\n  patch(\"toString\");\n  patch(\"toDOM\");\n  patch(\"toArray\");\n  patch(\"getAttribute\");\n  patchGetter(\"firstChild\");\n\n  return value;\n}\n","import * as Y from \"yjs\";\nimport { observeArray } from \"./types/array\";\nimport { observeDoc } from \"./types/doc\";\nimport { observeMap } from \"./types/map\";\nimport { observeText } from \"./types/text\";\nimport { observeXml } from \"./types/xml\";\n\nexport function isYType(element: any) {\n  return element instanceof Y.AbstractType || Object.prototype.hasOwnProperty.call(element, \"autoLoad\"); // detect subdocs. Is there a better way for this?\n}\n\nexport function observeYJS(element: Y.AbstractType<any> | Y.Doc) {\n  if (element instanceof Y.XmlText) {\n    return observeText(element);\n  } else if (element instanceof Y.Text) {\n    return observeText(element);\n  } else if (element instanceof Y.Array) {\n    return observeArray(element);\n  } else if (element instanceof Y.Map) {\n    return observeMap(element);\n  } else if (element instanceof Y.Doc || Object.prototype.hasOwnProperty.call(element, \"autoLoad\")) {\n    // subdoc. Ok way to detect this?\n    return observeDoc(element as any as Y.Doc);\n  } else if (element instanceof Y.XmlFragment) {\n    return observeXml(element);\n  } else if (element instanceof Y.XmlElement) {\n    return observeXml(element);\n  } else {\n    if (element._item === null && element._start === null) {\n      // console.warn(\"edge case\");\n    } else {\n      // throw new Error(\"not yet supported\");\n    }\n  }\n  return element;\n}\n\nfunction makeYDocRootLevelTypesObservable(doc: Y.Doc) {\n  doc.share.forEach((type) => {\n    // the explicit check is necessary because we sometimes initialize \"anonymous\" types that the user can't (and shouldn't) access.\n    if (type.constructor !== Y.AbstractType) {\n      // console.log(\"root\", type)\n      observeYJS(type);\n    }\n  });\n}\n\nfunction makeStructsObservable(structs: (Y.Item | Y.GC)[], startPos: number) {\n  for (let i = structs.length - 1; i >= startPos; i--) {\n    let struct = structs[i];\n    if (!struct.deleted) {\n      if (struct instanceof Y.GC) {\n        continue;\n      }\n      struct.content?.getContent().forEach((content) => {\n        if (content instanceof Y.AbstractType) {\n          // console.log(\"struct\", content)\n          observeYJS(content);\n          // console.log(content, \"is a created type type\");\n        }\n      });\n    }\n  }\n}\n\nconst docsObserved = new WeakSet<Y.Doc>();\n\nexport function makeYDocObservable(doc: Y.Doc) {\n  if (docsObserved.has(doc)) {\n    return;\n  }\n  docsObserved.add(doc);\n  // based on https://github.com/yjs/yjs/pull/298#issuecomment-937636849\n\n  // hook new root type creations (when calling getMap() or getArray(), etc)\n  observeYJS(doc);\n\n  // observe all structs already in the document\n  doc.store.clients.forEach((entry) => {\n    if (entry) {\n      makeStructsObservable(entry, 0);\n    }\n  });\n\n  // observe all root-types\n  makeYDocRootLevelTypesObservable(doc);\n\n  // observe newly created types from now on\n  doc.on(\"beforeObserverCalls\", (tr: Y.Transaction) => {\n    // observe new root types\n    makeYDocRootLevelTypesObservable(doc);\n\n    // observe new structs\n    tr.afterState.forEach((clock, client) => {\n      const beforeClock = tr.beforeState.get(client) || 0;\n      if (beforeClock !== clock) {\n        const structs = tr.doc.store.clients.get(client);\n        if (!structs) {\n          return;\n        }\n        const firstChangePos = Y.findIndexSS(structs, beforeClock);\n        makeStructsObservable(structs, firstChangePos);\n      }\n    });\n  });\n}\n\nexport { enableMobxBindings, enableReactiveBindings, enableVueBindings } from \"./observableProvider\";\n"],"names":["customCreateAtom","customReaction","defaultReaction","func","reaction","effect","undefined","createAtom","_name","_onBecomeObservedHandler","_onBecomeUnobservedHandler","apply","arguments","Error","enableMobxBindings","mobx","enableVueBindings","vue","name","onBecomeObserved","id","data","reactive","atom","reportObserved","reportChanged","enableReactiveBindings","onBecomeUnobserved","fireImmediately","arraysObserved","WeakSet","observeArray","array","has","add","selfAtom","atoms","Map","reportSelfAtom","handler","event","changes","added","size","deleted","keys","delta","length","observe","unobserve","_implicitObserver","reportArrayElementAtom","key","get","set","originalGet","ret","Reflect","patch","method","originalFunction","patchGetter","target","descriptor","Object","getOwnPropertyDescriptor","getPrototypeOf","_disableTracking","defineProperty","copyGetter","newMethodName","originalPush","push","content","call","originalSlice","slice","start","end","docsObserved","observeDoc","doc","oldKeys","Array","from","share","tr","newKeys","JSON","stringify","on","off","observeYJS","previous","args","removeObservers","mapsObserved","observeMap","map","reportMapKeyAtom","keysChanged","textsObserved","observeText","value","_changes","xmlsObserved","observeXml","isYType","element","Y","AbstractType","prototype","hasOwnProperty","XmlText","Text","Doc","XmlFragment","XmlElement","makeYDocRootLevelTypesObservable","forEach","type","constructor","makeStructsObservable","structs","startPos","i","struct","GC","getContent","makeYDocObservable","store","clients","entry","afterState","clock","client","beforeClock","beforeState","firstChangePos","findIndexSS"],"mappings":"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"}