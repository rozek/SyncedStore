{"version":3,"file":"syncedstore.umd.js","sources":["../src/boxed.ts","../src/array.ts","../src/object.ts","../src/types.ts","../src/internal.ts","../src/doc.ts","../src/util.ts","../src/index.ts"],"sourcesContent":["import { JSONValue } from \"./types\";\n\n/**\n * @ignore\n */\nexport class Box<T extends Readonly<JSONValue>> {\n  constructor(public readonly value: T) {}\n}\n\nexport function boxed<T extends JSONValue>(value: T) {\n  if (ArrayBuffer.isView(value)) {\n    // can't freeze arraybuffer\n    return new Box(value as T);\n  } else {\n    return new Box(Object.freeze(value) as T);\n  }\n}\n","import { $reactive, $reactiveproxy, reactive } from \"@reactivedata/reactive\";\nimport * as Y from \"yjs\";\nimport { areSame, getYjsValue, INTERNAL_SYMBOL } from \".\";\nimport { Box } from \"./boxed\";\nimport { crdtValue, ObjectSchemaType, parseYjsReturnValue } from \"./internal\";\nimport { CRDTObject } from \"./object\";\n\nexport type CRDTArray<T> = {\n  [INTERNAL_SYMBOL]?: Y.Array<T>;\n  [n: number]: T extends Box<infer A>\n    ? A\n    : T extends Array<infer A>\n    ? CRDTArray<A>\n    : T extends ObjectSchemaType\n    ? CRDTObject<T>\n    : T;\n} & T[]; // TODO: should return ArrayImplementation<T> on getter\n\nfunction arrayImplementation<T>(arr: Y.Array<T>) {\n  const slice = function slice() {\n    let ic = this[$reactiveproxy]?.implicitObserver;\n    (arr as any)._implicitObserver = ic;\n\n    const items = arr.slice.bind(arr).apply(arr, arguments);\n    return items.map((item) => {\n      const ret = parseYjsReturnValue(item, ic);\n      if (ic && typeof ret === \"object\") {\n        // when using Reactive, we should make sure the returned\n        // object is made reactive with the implicit observer ic\n        return reactive(ret, ic);\n      } else {\n        return ret;\n      }\n    });\n  } as T[][\"slice\"];\n\n  const wrapItems = function wrapItems(items) {\n    return items.map((item) => {\n      const wrapped = crdtValue(item as any); // TODO\n      let valueToSet = getYjsValue(wrapped) || wrapped;\n      if (valueToSet instanceof Box) {\n        valueToSet = valueToSet.value;\n      }\n      if (valueToSet instanceof Y.AbstractType && valueToSet.parent) {\n        throw new Error(\"Not supported: reassigning object that already occurs in the tree.\");\n      }\n      return valueToSet;\n    });\n  };\n\n  const findIndex = function findIndex() {\n    return [].findIndex.apply(slice.apply(this), arguments);\n  } as T[][\"find\"];\n\n  const methods = {\n    // get length() {\n    //   return arr.length;\n    // },\n    // set length(val: number) {\n    //   throw new Error(\"set length of yjs array is unsupported\");\n    // },\n    slice,\n    unshift: (...items: T[]) => {\n      arr.unshift(wrapItems(items));\n      return (arr as any).lengthUntracked;\n    },\n\n    push: (...items: T[]) => {\n      arr.push(wrapItems(items));\n      return (arr as any).lengthUntracked;\n    },\n\n    insert: arr.insert.bind(arr) as Y.Array<T>[\"insert\"],\n    toJSON: arr.toJSON.bind(arr) as Y.Array<T>[\"toJSON\"],\n\n    forEach: function () {\n      return [].forEach.apply(slice.apply(this), arguments);\n    } as T[][\"forEach\"],\n\n    every: function () {\n      return [].every.apply(slice.apply(this), arguments);\n    },\n\n    filter: function () {\n      return [].filter.apply(slice.apply(this), arguments);\n    } as T[][\"filter\"],\n\n    find: function () {\n      return [].find.apply(slice.apply(this), arguments);\n    } as T[][\"find\"],\n\n    findIndex,\n\n    some: function () {\n      return [].some.apply(slice.apply(this), arguments);\n    } as T[][\"some\"],\n\n    includes: function () {\n      return [].includes.apply(slice.apply(this), arguments);\n    } as T[][\"includes\"],\n\n    map: function () {\n      return [].map.apply(slice.apply(this), arguments);\n    } as T[][\"map\"],\n\n    indexOf: function () {\n      const arg = arguments[0];\n      return findIndex.call(this, (el) => areSame(el, arg));\n    } as T[][\"indexOf\"],\n\n    splice: function () {\n      let start = arguments[0] < 0 ? arr.length - Math.abs(arguments[0]) : arguments[0];\n      let deleteCount = arguments[1];\n      let items = Array.from(Array.from(arguments).slice(2));\n      let deleted = slice.apply(this, [start, Number.isInteger(deleteCount) ? start + deleteCount : undefined]);\n      if (arr.doc) {\n        arr.doc.transact(() => {\n          arr.delete(start, deleteCount);\n          arr.insert(start, wrapItems(items));\n        });\n      } else {\n        arr.delete(start, deleteCount);\n        arr.insert(start, wrapItems(items));\n      }\n      return deleted;\n    } as T[][\"splice\"],\n    // toJSON = () => {\n    //   return this.arr.toJSON() slice();\n    // };\n    // delete = this.arr.delete.bind(this.arr) as (Y.Array<T>)[\"delete\"];\n  };\n\n  const ret = [];\n  for (let method in methods) {\n    ret[method] = methods[method];\n  }\n\n  // this is necessary to prevent errors like \"trap reported non-configurability for property 'length' which is either non-existent or configurable in the proxy target\" when adding support for ownKeys and Reflect.keysx\n  // (not necessary anymore now we changed ret from object to array)\n\n  // Object.defineProperty(ret, \"length\", {\n  //   enumerable: false,\n  //   configurable: false,\n  //   writable: true,\n  //   value: (arr as any).lengthUntracked,\n  // });\n\n  return ret;\n}\n\nfunction propertyToNumber(p: string | number | symbol) {\n  if (typeof p === \"string\" && p.trim().length) {\n    const asNum = Number(p);\n    // https://stackoverflow.com/questions/10834796/validate-that-a-string-is-a-positive-integer\n    if (Number.isInteger(asNum)) {\n      return asNum;\n    }\n  }\n  return p;\n}\n\nexport function crdtArray<T>(initializer: T[], arr = new Y.Array<T>()) {\n  if (arr[$reactive]) {\n    throw new Error(\"unexpected\");\n    // arr = arr[$reactive].raw;\n  }\n  const implementation = arrayImplementation(arr);\n\n  const proxy = new Proxy(implementation as any as CRDTArray<T>, {\n    set: (target, pArg, value) => {\n      const p = propertyToNumber(pArg);\n      if (typeof p !== \"number\") {\n        throw new Error();\n      }\n      // TODO map.set(p, smartValue(value));\n      throw new Error(\"array assignment is not implemented / supported\");\n    },\n    get: (target, pArg, receiver) => {\n      const p = propertyToNumber(pArg);\n\n      if (p === INTERNAL_SYMBOL) {\n        return arr;\n      }\n\n      if (typeof p === \"number\") {\n        let ic: any;\n        if (receiver && receiver[$reactiveproxy]) {\n          ic = receiver[$reactiveproxy]?.implicitObserver;\n          (arr as any)._implicitObserver = ic;\n        } else {\n          // console.warn(\"no receiver getting property\", p);\n        }\n        let ret = arr.get(p) as any;\n        ret = parseYjsReturnValue(ret, ic);\n        return ret;\n      }\n\n      if (p === Symbol.toStringTag) {\n        return \"Array\";\n      }\n\n      if (p === Symbol.iterator) {\n        const values = arr.slice();\n        return Reflect.get(values, p);\n      }\n\n      if (p === \"length\") {\n        return arr.length;\n      }\n      // forward to arrayimplementation\n      const ret = Reflect.get(target, p, receiver);\n      return ret;\n    },\n    // getOwnPropertyDescriptor: (target, pArg) => {\n    //   const p = propertyToNumber(pArg);\n    //   if (typeof p === \"number\" && p < arr.length && p >= 0) {\n    //     return { configurable: true, enumerable: true, value: arr.get(p) };\n    //   } else {\n    //     return undefined;\n    //   }\n    // },\n    deleteProperty: (target, pArg) => {\n      const p = propertyToNumber(pArg);\n      if (typeof p !== \"number\") {\n        throw new Error();\n      }\n      if (p < (arr as any).lengthUntracked && p >= 0) {\n        arr.delete(p);\n        return true;\n      } else {\n        return false;\n      }\n    },\n    has: (target, pArg) => {\n      const p = propertyToNumber(pArg);\n      if (typeof p !== \"number\") {\n        // forward to arrayimplementation\n        return Reflect.has(target, p);\n      }\n      if (p < (arr as any).lengthUntracked && p >= 0) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    getOwnPropertyDescriptor(target, pArg) {\n      const p = propertyToNumber(pArg);\n      if (p === \"length\") {\n        return {\n          enumerable: false,\n          configurable: false,\n          writable: true,\n        };\n      }\n      if (typeof p === \"number\" && p >= 0 && p < (arr as any).lengthUntracked) {\n        return {\n          enumerable: true,\n          configurable: true,\n          writable: true,\n        };\n      }\n      return undefined;\n    },\n    ownKeys: (target) => {\n      const keys: string[] = [];\n      for (let i = 0; i < arr.length; i++) {\n        keys.push(i + \"\");\n      }\n      keys.push(\"length\");\n      return keys;\n    },\n  });\n\n  implementation.push.apply(proxy, initializer);\n  return proxy;\n}\n","import { $reactive, $reactiveproxy } from \"@reactivedata/reactive\";\nimport * as Y from \"yjs\";\nimport { getYjsValue, INTERNAL_SYMBOL } from \".\";\nimport { CRDTArray } from \"./array\";\nimport { Box } from \"./boxed\";\nimport { crdtValue, parseYjsReturnValue, yToWrappedCache, ObjectSchemaType } from \"./internal\";\n\nexport type CRDTObject<T extends ObjectSchemaType> = {\n  [P in keyof T]?: T[P] extends Box<infer A>\n    ? Box<A>\n    : T[P] extends Array<infer A>\n    ? CRDTArray<A>\n    : T[P] extends ObjectSchemaType\n    ? CRDTObject<T[P]>\n    : T[P];\n} & {\n  [INTERNAL_SYMBOL]?: Y.Map<T>;\n};\n\nexport function crdtObject<T extends ObjectSchemaType>(initializer: T, map = new Y.Map<any>()) {\n  if (map[$reactive]) {\n    throw new Error(\"unexpected\");\n    // map = map[$reactive].raw;\n  }\n\n  const proxy = new Proxy({} as any as CRDTObject<T>, {\n    set: (target, p, value) => {\n      if (typeof p !== \"string\") {\n        throw new Error();\n      }\n      const wrapped = crdtValue(value); // TODO: maybe set cache\n      let valueToSet = getYjsValue(wrapped) || wrapped;\n\n      if (valueToSet instanceof Box) {\n        valueToSet = valueToSet.value;\n      }\n\n      if (valueToSet instanceof Y.AbstractType && valueToSet.parent) {\n        throw new Error(\"Not supported: reassigning object that already occurs in the tree.\");\n      }\n\n      map.set(p, valueToSet);\n\n      return true;\n    },\n    get: (target, p, receiver) => {\n      if (p === INTERNAL_SYMBOL) {\n        return map;\n      }\n      if (typeof p !== \"string\") {\n        return Reflect.get(target, p);\n        // throw new Error(\"get non string parameter\");\n      }\n      let ic: any;\n      if (receiver && receiver[$reactiveproxy]) {\n        ic = receiver[$reactiveproxy]?.implicitObserver;\n        (map as any)._implicitObserver = ic;\n      } else {\n        // console.warn(\"no receiver getting property\", p);\n      }\n      let ret = map.get(p);\n      ret = parseYjsReturnValue(ret, ic);\n      return ret;\n    },\n    deleteProperty: (target, p) => {\n      if (typeof p !== \"string\") {\n        throw new Error();\n      }\n      if (map.has(p)) {\n        map.delete(p);\n        return true;\n      } else {\n        return false;\n      }\n    },\n    has: (target, p) => {\n      if (typeof p === \"string\" && map.has(p)) {\n        return true;\n      }\n      return false;\n    },\n    getOwnPropertyDescriptor(target, p) {\n      if (typeof p === \"string\" && map.has(p)) {\n        return {\n          enumerable: true,\n          configurable: true,\n        };\n      }\n      return undefined;\n    },\n    ownKeys: (target) => {\n      return Array.from(map.keys());\n    },\n  });\n\n  yToWrappedCache.set(map, proxy);\n\n  for (let key in initializer) {\n    proxy[key] = initializer[key] as any;\n  }\n\n  return proxy;\n}\n","import * as Y from \"yjs\";\n\nexport type Primitive = bigint | boolean | null | number | string | symbol | undefined;\n\nexport type JSONValue = Primitive | JSONObject | JSONArray;\n\nexport type JSONObject = {\n  [key: string]: JSONValue;\n};\n\nexport type JSONArray = Array<JSONValue>;\n\nexport function isYType(element: any) {\n  return element instanceof Y.AbstractType;\n}\n","import { markRaw } from \"@reactivedata/reactive\";\nimport * as Y from \"yjs\";\nimport { getYjsValue } from \".\";\nimport { crdtArray } from \"./array\";\nimport { Box, boxed } from \"./boxed\";\nimport { crdtObject } from \"./object\";\nimport { isYType, JSONValue } from \"./types\";\n\ntype NestedSchemaType = JSONValue | ObjectSchemaType | Box<any> | Y.AbstractType<any> | NestedSchemaType[];\n\nexport type ObjectSchemaType = {\n  [key: string]: NestedSchemaType;\n};\n\nexport const yToWrappedCache = new WeakMap<Y.AbstractType<any> | Y.Doc, any>();\n\nexport function parseYjsReturnValue(value: any, implicitObserver?: any) {\n  if (isYType(value)) {\n    value._implicitObserver = implicitObserver;\n\n    if (value instanceof Y.Array || value instanceof Y.Map) {\n      if (!yToWrappedCache.has(value)) {\n        const wrapped = crdtValue(value);\n        yToWrappedCache.set(value, wrapped);\n      }\n      value = yToWrappedCache.get(value);\n    } else if (\n      value instanceof Y.XmlElement ||\n      value instanceof Y.XmlFragment ||\n      value instanceof Y.XmlText ||\n      value instanceof Y.XmlHook ||\n      value instanceof Y.Text\n    ) {\n      markRaw(value);\n      (value as any).__v_skip = true; // for vue Reactive\n    } else {\n      throw new Error(\"unknown YType\");\n    }\n    return value;\n  } else if (value === null) {\n    return null;\n  } else if (typeof value === \"object\") {\n    return boxed(value); // TODO: how do we recognize a boxed \"null\" value?\n  }\n  return value;\n}\n\nexport function crdtValue<T extends NestedSchemaType>(value: T | Y.Array<any> | Y.Map<any>) {\n  if (value === null || value === undefined) {\n    return value;\n  }\n  value = (getYjsValue(value as any) as any) || value; // unwrap\n  if (value instanceof Y.Array) {\n    return crdtArray([], value);\n  } else if (value instanceof Y.Map) {\n    return crdtObject({}, value);\n  } else if (typeof value === \"string\") {\n    return value; // TODO\n  } else if (Array.isArray(value)) {\n    return crdtArray(value as any[]);\n  } else if (\n    value instanceof Y.XmlElement ||\n    value instanceof Y.XmlFragment ||\n    value instanceof Y.XmlText ||\n    value instanceof Y.XmlHook\n  ) {\n    return value;\n  } else if (value instanceof Y.Text) {\n    return value;\n  } else if (typeof value === \"object\") {\n    if (value instanceof Box) {\n      return value;\n    } else {\n      return crdtObject(value as any);\n    }\n  } else if (typeof value === \"number\" || typeof value === \"boolean\") {\n    return value;\n  } else {\n    throw new Error(\"invalid\");\n  }\n}\n","import { $reactive, $reactiveproxy } from \"@reactivedata/reactive\";\nimport * as Y from \"yjs\";\nimport { INTERNAL_SYMBOL } from \".\";\nimport { parseYjsReturnValue, yToWrappedCache } from \"./internal\";\n\nexport type docElementTypeDescription = \"xml\" | \"text\" | Array<any> | object;\nexport type DocTypeDescription = {\n  [key: string]: docElementTypeDescription;\n};\n\nexport type MappedTypeDescription<T extends DocTypeDescription> = {\n  readonly [P in keyof T]: T[P] extends \"xml\"\n    ? Y.XmlFragment\n    : T[P] extends \"text\"\n    ? Y.Text\n    : T[P] extends Array<any>\n    ? T[P]\n    : T[P] extends object\n    ? Partial<T[P]>\n    : never;\n};\n\n// export type rootTypeDescription<T extends rootTypeDescriptionParent> = {\n//   [P in keyof T]?: T[P];\n// };\n\nfunction validateRootTypeDescription<T extends DocTypeDescription>(typeDescription: T) {\n  for (let [key, val] of Object.entries(typeDescription)) {\n    if (Array.isArray(val)) {\n      if (val.length !== 0) {\n        throw new Error(\"Root Array initializer must always be empty array\");\n      }\n    } else if (val && typeof val === \"object\") {\n      if (Object.keys(val).length !== 0 || Object.getPrototypeOf(val) !== Object.prototype) {\n        throw new Error(\"Root Object initializer must always be {}\");\n      }\n    } else if (val !== \"xml\" && val !== \"text\") {\n      throw new Error(\"unknown Root initializer\");\n    }\n  }\n}\n\nfunction getYjsByTypeDescription<T extends DocTypeDescription>(doc: Y.Doc, typeDescription: T, p: string) {\n  let description = typeDescription[p];\n  if (!description) {\n    // exclude expected Vue Reactive checks from logging a warning\n    if (p !== \"__v_raw\" && p !== \"__v_isRef\" && p !== \"__v_isReadonly\" && p != \"$$typeof\") {\n      console.warn(\"property not found on root doc\", p);\n    }\n    return undefined;\n  }\n\n  return description === \"xml\"\n    ? doc.getXmlFragment(p)\n    : description === \"text\"\n    ? doc.getText(p)\n    : Array.isArray(description)\n    ? doc.getArray(p)\n    : doc.getMap(p);\n}\nexport function crdtDoc<T extends DocTypeDescription>(doc: Y.Doc, typeDescription: T) {\n  if (doc[$reactive]) {\n    throw new Error(\"unexpected\");\n  }\n\n  validateRootTypeDescription(typeDescription);\n\n  const proxy = new Proxy({} as MappedTypeDescription<T>, {\n    set: (target, p, value) => {\n      if (typeof p !== \"string\") {\n        throw new Error();\n      }\n      throw new Error(\"cannot set new elements on root doc\");\n    },\n    get: (target, p, receiver) => {\n      if (p === INTERNAL_SYMBOL) {\n        return doc;\n      }\n\n      if (typeof p !== \"string\") {\n        return Reflect.get(target, p);\n        // throw new Error(\"get non string parameter\");\n      }\n      let ic: any;\n      if (receiver && receiver[$reactiveproxy]) {\n        ic = receiver[$reactiveproxy]?.implicitObserver;\n        (doc as any)._implicitObserver = ic;\n      } else {\n        // console.warn(\"no receiver getting property\", p);\n      }\n\n      if (p === \"toJSON\") {\n        for (let key of Object.keys(typeDescription)) {\n          // initialize all values\n          getYjsByTypeDescription(doc, typeDescription, key);\n        }\n        const ret = Reflect.get(doc, p);\n        return ret;\n      }\n\n      let ret = getYjsByTypeDescription(doc, typeDescription, p);\n      ret = parseYjsReturnValue(ret, ic);\n\n      return ret;\n    },\n    deleteProperty: (target, p) => {\n      throw new Error(\"deleteProperty not available for doc\");\n    },\n    has: (target, p) => {\n      if (typeof p === \"string\" && doc.share.has(p)) {\n        return true;\n      }\n      return false;\n    },\n    getOwnPropertyDescriptor(target, p) {\n      if ((typeof p === \"string\" && doc.share.has(p)) || p === \"toJSON\") {\n        return {\n          enumerable: true,\n          configurable: true,\n        };\n      }\n      return undefined;\n    },\n    ownKeys: (target) => {\n      return Array.from(doc.share.keys());\n    },\n  });\n\n  yToWrappedCache.set(doc, proxy);\n\n  return proxy;\n}\n","/**\n * Filter a SyncedStore array\n * @param arr array to filter\n * @param filter predicate to filter the array `arr` by\n */\nexport function filterArray<T>(arr: T[], filter: (obj: T) => boolean) {\n  for (let i = arr.length - 1; i >= 0; i--) {\n    if (!filter(arr[i])) {\n      arr.splice(i, 1);\n    }\n  }\n}\n","import * as reactive from \"@reactivedata/reactive\";\nimport { markRaw } from \"@reactivedata/reactive\";\nimport { enableReactiveBindings, makeYDocObservable } from \"@syncedstore/yjs-reactive-bindings\";\nimport * as Y from \"yjs\";\nimport {\n  Array as SyncedArray,\n  Doc as SyncedDoc,\n  Map as SyncedMap,\n  Text as SyncedText,\n  XmlFragment as SyncedXml,\n} from \"yjs\";\nimport { crdtDoc, DocTypeDescription } from \"./doc\";\n\nexport { enableMobxBindings, enableVueBindings } from \"@syncedstore/yjs-reactive-bindings\";\nexport { Box, boxed } from \"./boxed\";\nexport * from \"./util\";\n/**\n * @ignore\n */\nexport { Y };\n/**\n * @ignore\n */\nexport { SyncedDoc, SyncedArray, SyncedMap, SyncedXml, SyncedText };\n\n// setup yjs-reactive-bindings\n\nenableReactiveBindings(reactive); // use reactive bindings by default\n\n/**\n * @ignore\n */\nexport const INTERNAL_SYMBOL = Symbol(\"INTERNAL_SYMBOL\");\n\n/**\n * Register a listener for when any changes to `object` or its nested objects occur.\n *\n * @param object the synced object (store, object, map, or Yjs value to observe)\n * @param handler the callback to be raised.\n * @returns a function to dispose (unregister) the handler\n */\nexport function observeDeep(object: any, handler: () => void): () => void {\n  const internal = getYjsValue(object) || object;\n  if (!internal) {\n    throw new Error(\"not a valid synced object\");\n  }\n\n  if (internal instanceof Y.Doc) {\n    internal.on(\"update\", handler);\n    return () => {\n      internal.off(\"update\", handler);\n    };\n  } else {\n    internal.observeDeep(handler);\n    return () => {\n      internal.unobserveDeep(handler);\n    };\n  }\n}\n\n/**\n * Access the internal Yjs Doc.\n *\n * @param store a store returned by\n * @returns the Yjs doc (Y.Doc) underneath.\n */\nexport function getYjsDoc<T>(store: T): Y.Doc {\n  const ret = getYjsValue(store);\n  if (!(ret instanceof Y.Doc)) {\n    throw new Error(\"store is not a valid syncedStore that maps to a Y.Doc\");\n  }\n  return ret;\n}\n\n/**\n * Access the internal Yjs value that backs the syncing of the passed in object.\n *\n * @param object a value retrieved from the store\n * @returns the Yjs value underneath. This can be a Y.Doc, Y.Array, Y.Map or other Y-type based on the value passed in\n */\nexport function getYjsValue(object: any): Y.Doc | Y.AbstractType<any> | undefined {\n  if (typeof object !== \"object\" || object === null) {\n    return undefined;\n  }\n  const ret = object[INTERNAL_SYMBOL];\n  if (ret) {\n    markRaw(ret);\n    (ret as any).__v_skip = true; // for vue Reactive\n  }\n  return ret;\n}\n\n/**\n * Check whether two objects represent the same value.\n * A strict equality (===) check doesn't always work,\n * because SyncedStore can wrap the object with a Proxy depending on where you retrieved it.\n *\n * @param objectA Object to compare with objectB\n * @param objectB Object to compare with objectA\n * @returns true if they represent the same object, false otherwise\n */\nexport function areSame(objectA: any, objectB: any) {\n  if (objectA === objectB) {\n    return true;\n  }\n  if (typeof objectA === \"object\" && typeof objectB === \"object\") {\n    const internalA = getYjsValue(objectA);\n    const internalB = getYjsValue(objectB);\n    if (!internalA || !internalB) {\n      // one of them doesn't have an internal value\n      return false;\n    }\n    return internalA === internalB;\n  }\n  return false;\n}\n\n/**\n * Create a SyncedStore store\n * @param shape an object that describes the root types of the store. e.g.:\n *  const shape = {\n *    exampleArrayData: [],\n *    exampleObjectData: {},\n *    exampleXMLData: \"xml\",\n *    exampleTextData: \"text\",\n * };\n * @param doc (optional) a Y.Doc to use as the backing system\n * @returns a SyncedStore store\n */\nexport function syncedStore<T extends DocTypeDescription>(shape: T, doc: Y.Doc = new Y.Doc()) {\n  makeYDocObservable(doc);\n\n  return crdtDoc<T>(doc, shape);\n}\n\nexport default syncedStore;\n"],"names":["Box","constructor","value","boxed","ArrayBuffer","isView","Object","freeze","arrayImplementation","arr","slice","ic","$reactiveproxy","implicitObserver","_implicitObserver","items","bind","apply","arguments","map","item","ret","parseYjsReturnValue","reactive","wrapItems","wrapped","crdtValue","valueToSet","getYjsValue","Y","AbstractType","parent","Error","findIndex","methods","unshift","call","lengthUntracked","push","insert","toJSON","forEach","every","filter","find","some","includes","indexOf","arg","el","areSame","splice","start","length","Math","abs","deleteCount","Array","from","deleted","Number","isInteger","undefined","doc","transact","delete","method","propertyToNumber","p","trim","asNum","crdtArray","initializer","$reactive","implementation","proxy","Proxy","set","target","pArg","get","receiver","INTERNAL_SYMBOL","Symbol","toStringTag","iterator","values","Reflect","deleteProperty","has","getOwnPropertyDescriptor","enumerable","configurable","writable","ownKeys","keys","i","crdtObject","Map","yToWrappedCache","key","isYType","element","WeakMap","XmlElement","XmlFragment","XmlText","XmlHook","Text","markRaw","__v_skip","isArray","validateRootTypeDescription","typeDescription","val","entries","getPrototypeOf","prototype","getYjsByTypeDescription","description","console","warn","getXmlFragment","getText","getArray","getMap","crdtDoc","share","filterArray","enableReactiveBindings","observeDeep","object","handler","internal","Doc","on","off","unobserveDeep","getYjsDoc","store","objectA","objectB","internalA","internalB","syncedStore","shape","makeYDocObservable"],"mappings":"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"}